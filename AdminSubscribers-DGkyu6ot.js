import{c as z,r as a,s as p,j as e,A as X,S as V,C as W}from"./index-BZafi1pq.js";import{C as A}from"./check-circle-D4RSxU1c.js";import{T}from"./trash-2-BJdltfnZ.js";import{C as G}from"./chevron-left-CKgXfDlP.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=z("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=z("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=z("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),se=()=>{const[o,N]=a.useState([]),[d,f]=a.useState([]),[S,j]=a.useState(!0),[u,_]=a.useState(""),[h,F]=a.useState("all"),[r,g]=a.useState([]),[I,k]=a.useState(!1),[m,O]=a.useState(""),[y,L]=a.useState({show:!1,type:"",message:""}),[b,E]=a.useState(1),[v,R]=a.useState(0),w=10;a.useEffect(()=>{C()},[b,h]),a.useEffect(()=>{if(u){const t=o.filter(s=>s.email.toLowerCase().includes(u.toLowerCase()));f(t)}else f(o)},[u,o]);const C=async()=>{j(!0);try{let t=p.from("newsletter_subscribers").select("*",{count:"exact"});h==="active"?t=t.eq("active",!0):h==="inactive"&&(t=t.eq("active",!1));const s=(b-1)*w,l=s+w-1,{data:c,count:x,error:i}=await t.order("created_at",{ascending:!1}).range(s,l);if(i)throw i;N(c||[]),f(c||[]),R(x||0)}catch(t){console.error("Error fetching subscribers:",t),n("error","Failed to load subscribers")}finally{j(!1)}},M=async(t,s)=>{try{const{error:l}=await p.from("newsletter_subscribers").update({active:s,unsubscribed_at:s?null:new Date().toISOString()}).eq("id",t);if(l)throw l;N(o.map(c=>c.id===t?{...c,active:s,unsubscribed_at:s?null:new Date().toISOString()}:c)),f(d.map(c=>c.id===t?{...c,active:s,unsubscribed_at:s?null:new Date().toISOString()}:c)),n("success",`Subscriber ${s?"activated":"deactivated"} successfully`)}catch(l){console.error("Error updating subscriber status:",l),n("error","Failed to update subscriber status")}},B=async t=>{if(confirm("Are you sure you want to delete this subscriber?"))try{const{error:s}=await p.from("newsletter_subscribers").delete().eq("id",t);if(s)throw s;N(o.filter(l=>l.id!==t)),f(d.filter(l=>l.id!==t)),n("success","Subscriber deleted successfully")}catch(s){console.error("Error deleting subscriber:",s),n("error","Failed to delete subscriber")}},P=t=>{t.target.checked?g(d.map(s=>s.id)):g([])},U=t=>{r.includes(t)?g(r.filter(s=>s!==t)):g([...r,t])},D=t=>{if(r.length===0){n("error","Please select at least one subscriber");return}O(t),k(!0)},H=async()=>{j(!0);try{if(m==="delete"){const{error:t}=await p.from("newsletter_subscribers").delete().in("id",r);if(t)throw t;n("success",`${r.length} subscribers deleted successfully`)}else if(m==="activate"){const{error:t}=await p.from("newsletter_subscribers").update({active:!0,unsubscribed_at:null}).in("id",r);if(t)throw t;n("success",`${r.length} subscribers activated successfully`)}else if(m==="deactivate"){const{error:t}=await p.from("newsletter_subscribers").update({active:!1,unsubscribed_at:new Date().toISOString()}).in("id",r);if(t)throw t;n("success",`${r.length} subscribers deactivated successfully`)}await C(),g([])}catch(t){console.error("Error performing bulk action:",t),n("error","Failed to perform bulk action")}finally{j(!1),k(!1)}},Q=()=>{const t=h==="all"?o:o.filter(i=>h==="active"?i.active:!i.active),s=[["Email","Status","Source","Subscribed Date","Unsubscribed Date"].join(","),...t.map(i=>[i.email,i.active?"Active":"Inactive",i.source||"",new Date(i.subscribed_at).toLocaleDateString(),i.unsubscribed_at?new Date(i.unsubscribed_at).toLocaleDateString():""].join(","))].join(`
`),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(l),x=document.createElement("a");x.setAttribute("href",c),x.setAttribute("download",`subscribers_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x),n("success","Subscribers exported successfully")},n=(t,s)=>{L({show:!0,type:t,message:s}),setTimeout(()=>{L({show:!1,type:"",message:""})},5e3)},$=Math.ceil(v/w);return e.jsxs("div",{className:"h-full",children:[y.show&&e.jsxs("div",{className:`fixed top-6 right-6 z-50 p-4 rounded-md shadow-lg flex items-start ${y.type==="success"?"bg-green-500/20 border border-green-500/30 text-green-400":y.type==="error"?"bg-red-500/20 border border-red-500/30 text-red-400":"bg-blue-500/20 border border-blue-500/30 text-blue-400"}`,children:[y.type==="success"?e.jsx(A,{size:18,className:"mr-3 mt-0.5 flex-shrink-0"}):e.jsx(X,{size:18,className:"mr-3 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:y.message})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-medium text-white mb-4",children:"Confirm Action"}),e.jsx("p",{className:"text-gray-300 mb-6",children:m==="delete"?`Are you sure you want to delete ${r.length} subscribers? This action cannot be undone.`:m==="activate"?`Are you sure you want to activate ${r.length} subscribers?`:`Are you sure you want to deactivate ${r.length} subscribers?`}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-500 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:H,className:`px-4 py-2 rounded text-white flex items-center ${m==="delete"?"bg-red-600 hover:bg-red-700":"bg-yellow-500 hover:bg-yellow-600"}`,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white\\",xmlns:"http://www.w3.org/2000/svg\\",fill:"none\\",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25\\",cx:"12\\",cy:"12\\",r:"10\\",stroke:"currentColor\\",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Confirm"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-serif text-white mb-2",children:"Newsletter Subscribers"}),e.jsx("p",{className:"text-gray-400",children:"Manage your newsletter subscribers and their preferences."})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx("input",{type:"text",placeholder:"Search subscribers...",value:u,onChange:t=>_(t.target.value),className:"w-full px-4 py-2 pl-10 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white"}),e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]}),e.jsxs("select",{value:h,onChange:t=>F(t.target.value),className:"px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",children:[e.jsx("option",{value:"all",children:"All Subscribers"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-white",title:"Refresh",children:e.jsx(K,{size:18})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>D("activate"),disabled:r.length===0,className:"px-3 py-1.5 bg-green-600/20 text-green-400 rounded hover:bg-green-600/30 transition-colors text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(A,{size:16,className:"mr-1"}),"Activate"]}),e.jsxs("button",{onClick:()=>D("deactivate"),disabled:r.length===0,className:"px-3 py-1.5 bg-yellow-600/20 text-yellow-400 rounded hover:bg-yellow-600/30 transition-colors text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(q,{size:16,className:"mr-1"}),"Deactivate"]}),e.jsxs("button",{onClick:()=>D("delete"),disabled:r.length===0,className:"px-3 py-1.5 bg-red-600/20 text-red-400 rounded hover:bg-red-600/30 transition-colors text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(T,{size:16,className:"mr-1"}),"Delete"]}),e.jsxs("button",{onClick:Q,className:"px-3 py-1.5 bg-blue-600/20 text-blue-400 rounded hover:bg-blue-600/30 transition-colors text-sm flex items-center",children:[e.jsx(J,{size:16,className:"mr-1"}),"Export"]})]})]}),S?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400"})}):e.jsx(e.Fragment,{children:d.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col\\",className:"px-3 py-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-yellow-400 border-gray-300 rounded",onChange:P,checked:r.length===d.length&&d.length>0})})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Source"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Subscribed Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-slate-800 divide-y divide-gray-700",children:d.map(t=>e.jsxs("tr",{className:"hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-yellow-400 border-gray-300 rounded",onChange:()=>U(t.id),checked:r.includes(t.id)})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-white",children:t.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.active?"bg-green-400/20 text-green-300":"bg-red-400/20 text-red-300"}`,children:t.active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.source||"website"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:new Date(t.subscribed_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.unsubscribed_at?`Unsubscribed on ${new Date(t.unsubscribed_at).toLocaleDateString()}`:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[t.active?e.jsx("button",{onClick:()=>M(t.id,!1),className:"text-yellow-400 hover:text-yellow-300",title:"Deactivate",children:e.jsx(q,{size:18})}):e.jsx("button",{onClick:()=>M(t.id,!0),className:"text-green-400 hover:text-green-300",title:"Activate",children:e.jsx(A,{size:18})}),e.jsx("button",{onClick:()=>B(t.id),className:"text-red-400 hover:text-red-300",title:"Delete",children:e.jsx(T,{size:18})})]})})]},t.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium",children:Math.min((b-1)*w+1,v)})," to ",e.jsx("span",{className:"font-medium",children:Math.min(b*w,v)})," of ",e.jsx("span",{className:"font-medium",children:v})," subscribers"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E(t=>Math.max(1,t-1)),disabled:b===1,className:"p-2 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(G,{size:16})}),e.jsx("button",{onClick:()=>E(t=>Math.min($,t+1)),disabled:b>=$,className:"p-2 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(W,{size:16})})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl text-gray-600 mb-4",children:"📬"}),e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No subscribers found"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:u?"Try adjusting your search query or filters.":"There are no newsletter subscribers yet. They will appear here when people subscribe to your newsletter."}),u&&e.jsx("button",{onClick:()=>_(""),className:"mt-4 px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Clear Search"})]})})]})]})};export{se as default};
