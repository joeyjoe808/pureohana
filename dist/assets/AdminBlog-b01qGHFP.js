import{r as l,s as d,j as e,A,S as I}from"./index-D4gBdtZF.js";import{F as M}from"./FileUploader-QrcrLKIc.js";import{C as U}from"./check-circle-fnKANasE.js";import{C as B}from"./chevron-left-qEarwycx.js";import{S as $}from"./save-CfxmEbD6.js";import{P as H}from"./plus-circle-DAzUKitC.js";import{E as O}from"./eye-C-7k4V01.js";import{S as R}from"./square-pen-CzAMoQtg.js";import{T as V}from"./trash-2-DXrXcYoY.js";import"./upload-CJi8tuAb.js";import"./refresh-cw-kYokf9fA.js";import"./check-DJ6ce73g.js";const re=()=>{const[C,_]=l.useState([]),[p,c]=l.useState(!0),[k,x]=l.useState(!1),[t,i]=l.useState(null),[S,P]=l.useState([]),[f,E]=l.useState([]),[h,z]=l.useState(""),[u,w]=l.useState({show:!1,type:"",message:""});l.useEffect(()=>{b()},[]);const b=async()=>{c(!0);try{const{data:s,error:a}=await d.from("posts").select("*, author:authors(id, name)").order("created_at",{ascending:!1});if(a)throw console.error("Error fetching posts:",a),a;const{data:r,error:m}=await d.from("categories").select("*").order("label",{ascending:!0});if(m)throw console.error("Error fetching categories:",m),m;const{data:g,error:y}=await d.from("authors").select("*");if(y)throw console.error("Error fetching authors:",y),y;console.log("Fetched data:",{posts:s,categories:r,authors:g}),_(s||[]),P(r||[{id:1,name:"weddings",label:"Weddings"},{id:2,name:"venues",label:"Venues"},{id:3,name:"planning",label:"Planning"},{id:4,name:"photography",label:"Photography"},{id:5,name:"culture",label:"Cultural Elements"}]),E(g||[{id:1,name:"Leilani Kealoha",image_url:"https://images.pexels.com/photos/774909/pexels-photo-774909.jpeg?auto=compress&cs=tinysrgb&w=100",bio:"Luxury wedding photographer and creative director specializing in sophisticated celebrations across the Hawaiian islands."}])}catch(s){console.error("Error fetching data:",s),n("error","Failed to load data. Please try again.")}finally{c(!1)}},j=()=>{i({title:"",slug:"",excerpt:"",content:"",featured_image:"",category:"",author_id:f.length>0?f[0].id:null,read_time:"5 min read",is_published:!1}),x(!0)},F=s=>{i(s),x(!0)},T=async()=>{if(!t.title||!t.slug||!t.category||!t.author_id){n("error","Please fill out all required fields");return}try{c(!0),t.slug||(t.slug=t.title.toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,"-")),console.log("Saving post:",t);let s;if(t.id){const{data:a,error:r}=await d.from("posts").update({title:t.title,slug:t.slug,excerpt:t.excerpt,content:t.content,featured_image:t.featured_image,category:t.category,author_id:t.author_id,read_time:t.read_time,is_published:t.is_published,updated_at:new Date().toISOString()}).eq("id",t.id).select();if(r)throw console.error("Error updating post:",r),r;console.log("Post updated successfully:",a),s=a,n("success","Post updated successfully")}else{const{data:a,error:r}=await d.from("posts").insert({title:t.title,slug:t.slug,excerpt:t.excerpt,content:t.content,featured_image:t.featured_image,category:t.category,author_id:t.author_id,read_time:t.read_time,is_published:t.is_published,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select();if(r)throw console.error("Error creating post:",r),r;console.log("Post created successfully:",a),s=a,n("success","Post created successfully")}b(),x(!1),i(null)}catch(s){console.error("Error saving post:",s),n("error","Failed to save post: "+s.message)}finally{c(!1)}},D=async s=>{if(confirm("Are you sure you want to delete this post?"))try{c(!0);const{error:a}=await d.from("posts").delete().eq("id",s);if(a)throw a;b(),n("success","Post deleted successfully")}catch(a){console.error("Error deleting post:",a),n("error","Failed to delete post: "+a.message)}finally{c(!1)}},o=s=>{const{name:a,value:r,type:m,checked:g}=s.target;i({...t,[a]:m==="checkbox"?g:r})},L=()=>{if(!(t!=null&&t.content))return"1 min read";const s=t.content.split(/\s+/).length;return`${Math.max(1,Math.ceil(s/200))} min read`},q=()=>t!=null&&t.title?t.title.toLowerCase().replace(/[^a-z0-9 ]/g,"").replace(/\s+/g,"-"):"",N=s=>{i({...t,featured_image:s})},n=(s,a)=>{w({show:!0,type:s,message:a}),setTimeout(()=>{w({show:!1,type:"",message:""})},5e3)},v=C.filter(s=>{var a,r;return((a=s.title)==null?void 0:a.toLowerCase().includes(h.toLowerCase()))||((r=s.excerpt)==null?void 0:r.toLowerCase().includes(h.toLowerCase()))});return e.jsxs("div",{className:"h-full",children:[u.show&&e.jsxs("div",{className:`fixed top-6 right-6 z-50 p-4 rounded-md shadow-lg flex items-start ${u.type==="success"?"bg-green-500/20 border border-green-500/30 text-green-400":u.type==="error"?"bg-red-500/20 border border-red-500/30 text-red-400":"bg-blue-500/20 border border-blue-500/30 text-blue-400"}`,children:[u.type==="success"?e.jsx(U,{size:18,className:"mr-3 mt-0.5 flex-shrink-0"}):e.jsx(A,{size:18,className:"mr-3 mt-0.5 flex-shrink-0"}),e.jsx("p",{children:u.message})]}),k?e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"text-gray-300 hover:text-white mr-4",children:e.jsx(B,{size:24})}),e.jsx("h1",{className:"text-2xl font-serif text-white",children:t.id?"Edit Post":"Create New Post"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Title*"}),e.jsx("input",{name:"title",value:t.title||"",onChange:o,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",placeholder:"Post Title",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2",children:["Slug*",e.jsx("button",{type:"button",onClick:()=>i({...t,slug:q()}),className:"ml-2 text-xs text-yellow-400 hover:text-yellow-300",children:"Generate from title"})]}),e.jsx("input",{name:"slug",value:t.slug||"",onChange:o,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",placeholder:"post-url-slug",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Category*"}),e.jsxs("select",{name:"category",value:t.category||"",onChange:o,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),S.map(s=>e.jsx("option",{value:s.name,children:s.label},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Author*"}),e.jsxs("select",{name:"author_id",value:t.author_id||"",onChange:o,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",required:!0,children:[e.jsx("option",{value:"",children:"Select Author"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2",children:["Reading Time",e.jsx("button",{type:"button",onClick:()=>i({...t,read_time:L()}),className:"ml-2 text-xs text-yellow-400 hover:text-yellow-300",children:"Calculate"})]}),e.jsx("input",{name:"read_time",value:t.read_time||"",onChange:o,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",placeholder:"5 min read"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Featured Image*"}),e.jsx(M,{value:t.featured_image||"",onChange:N,onUploadComplete:N,folder:"blog_images",fileTypes:["image/*"],maxSizeMB:5,placeholder:"Upload a featured image"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Excerpt*"}),e.jsx("textarea",{name:"excerpt",value:t.excerpt||"",onChange:o,rows:3,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",placeholder:"Brief summary of the post",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Content*"}),e.jsx("textarea",{name:"content",value:t.content||"",onChange:o,rows:15,className:"w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white font-mono",placeholder:"Post content...",required:!0}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Use blank lines to separate paragraphs. HTML is not supported."})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_published",name:"is_published",checked:t.is_published||!1,onChange:o,className:"mr-2"}),e.jsx("label",{htmlFor:"is_published",className:"text-gray-300",children:"Publish this post (otherwise it will be saved as a draft)"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-600 rounded text-gray-300 hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:T,className:"px-4 py-2 bg-yellow-400 text-slate-900 rounded hover:bg-yellow-500 transition-colors flex items-center",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-slate-900\\",xmlns:"http://www.w3.org/2000/svg\\",fill:"none\\",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25\\",cx:"12\\",cy:"12\\",r:"10\\",stroke:"currentColor\\",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{size:18,className:"mr-2"}),"Save Post"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-serif text-white",children:"Blog Management"}),e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-yellow-400 text-slate-900 rounded hover:bg-yellow-500 transition-colors flex items-center",children:[e.jsx(H,{size:18,className:"mr-2"}),"New Post"]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-white",children:"All Posts"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search posts...",value:h,onChange:s=>z(s.target.value),className:"px-4 py-2 pl-10 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white w-64"}),e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]})]}),p?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400"})}):e.jsx(e.Fragment,{children:v.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col\\",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Title"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Author"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-slate-800 divide-y divide-gray-700",children:v.map(s=>e.jsxs("tr",{className:"hover:bg-slate-700/50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:s.title}),e.jsx("div",{className:"text-sm text-gray-400",children:s.slug})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-400/20 text-yellow-300",children:s.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:s.author?s.author.name:"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.is_published?"bg-green-400/20 text-green-300":"bg-gray-400/20 text-gray-300"}`,children:s.is_published?"Published":"Draft"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>window.open(`/blog/${s.slug}`,"_blank"),className:"text-gray-400 hover:text-white",title:"View Post",children:e.jsx(O,{size:18})}),e.jsx("button",{onClick:()=>F(s),className:"text-blue-400 hover:text-blue-300",title:"Edit Post",children:e.jsx(R,{size:18})}),e.jsx("button",{onClick:()=>D(s.id),className:"text-red-400 hover:text-red-300",title:"Delete Post",children:e.jsx(V,{size:18})})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl text-gray-600 mb-4",children:"📝"}),h?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No posts found"}),e.jsx("p",{className:"text-gray-400",children:"Try adjusting your search query."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No blog posts yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Get started by creating your first blog post."}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-yellow-400 text-slate-900 rounded hover:bg-yellow-500 transition-colors",children:"Create Post"})]})]})})]})]})]})};export{re as default};
