import{c as k,r,s as L,j as e,S as P,f as U,a as I,A as R}from"./index-B4Le2Hq4.js";import{R as C}from"./refresh-cw-5i_ftdaB.js";import{C as T}from"./clock-BHAa73dO.js";import{U as q}from"./user-BmMJi1F_.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=k("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=k("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),J=()=>{const[S,y]=r.useState(!0),[u,A]=r.useState([]),[x,f]=r.useState([]),[l,g]=r.useState(""),[c,j]=r.useState("all"),[n,m]=r.useState(1),h=15;r.useEffect(()=>{w()},[]),r.useEffect(()=>{z()},[u,l,c]);const w=async()=>{try{y(!0);const{data:s,error:t}=await L.from("security_audit_logs").select(`
          id,
          user_id,
          action,
          resource_type,
          resource_id,
          ip_address,
          user_agent,
          details,
          created_at
        `).order("created_at",{ascending:!1}).limit(100);if(t)throw t;const a=s||[],b=a.filter(o=>o.user_id).map(o=>o.user_id);if(b.length>0){const{data:o,error:E}=await L.from("users").select("id, email").in("id",b);if(!E&&o){const _=o.reduce((i,v)=>(i[v.id]=v.email,i),{});a.forEach(i=>{i.user_id&&_[i.user_id]&&(i.user_email=_[i.user_id])})}}A(a),f(a)}catch(s){console.error("Error fetching security logs:",s)}finally{y(!1)}},z=()=>{let s=[...u];if(c!=="all"&&(s=s.filter(t=>t.action===c)),l){const t=l.toLowerCase();s=s.filter(a=>a.user_email&&a.user_email.toLowerCase().includes(t)||a.action&&a.action.toLowerCase().includes(t)||a.resource_type&&a.resource_type.toLowerCase().includes(t)||a.resource_id&&a.resource_id.toLowerCase().includes(t)||a.ip_address&&a.ip_address.includes(t))}f(s),m(1)},F=()=>{const s=u.map(t=>t.action).filter(Boolean);return[...new Set(s)]},d=Math.ceil(x.length/h),p=n*h,N=p-h,M=x.slice(N,p),D=s=>{switch(s){case"auth_sign_in":case"auth_sign_out":case"auth_sign_in_attempt":return e.jsx(q,{size:16,className:"text-blue-400"});case"data_create":case"data_update":case"data_delete":return e.jsx(Q,{size:16,className:"text-green-400"});case"security_alert":return e.jsx(R,{size:16,className:"text-red-400"});default:return e.jsx(O,{size:16,className:"text-yellow-400"})}};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-serif text-white mb-2",children:"Security Logs"}),e.jsx("p",{className:"text-gray-400",children:"Monitor security events and user activity across the system."})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search logs...",value:l,onChange:s=>g(s.target.value),className:"w-full px-4 py-2 pl-10 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white"}),e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16})]}),e.jsxs("select",{value:c,onChange:s=>j(s.target.value),className:"px-4 py-2 bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white",children:[e.jsx("option",{value:"all",children:"All Actions"}),F().map(s=>e.jsx("option",{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},s))]})]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors flex items-center",children:[e.jsx(C,{size:16,className:"mr-2"}),"Refresh Logs"]})]}),S?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(C,{size:24,className:"animate-spin text-yellow-400"})}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{size:48,className:"mx-auto text-gray-600 mb-4"}),e.jsx("h3",{className:"text-xl text-white mb-2",children:"No Security Logs Found"}),e.jsx("p",{className:"text-gray-400",children:l||c!=="all"?"No logs match your current filters. Try adjusting your search criteria.":"No security events have been recorded yet."}),(l||c!=="all")&&e.jsx("button",{onClick:()=>{g(""),j("all")},className:"mt-4 px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600 transition-colors",children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Action"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"IP Address"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Resource"})]})}),e.jsx("tbody",{className:"bg-slate-800 divide-y divide-gray-700",children:M.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-slate-700/40",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(I,{size:14,className:"text-gray-400 mt-0.5 mr-1.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-white",children:new Date(s.created_at).toLocaleDateString()}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center",children:[e.jsx(T,{size:10,className:"mr-1"}),new Date(s.created_at).toLocaleTimeString()]})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[D(s.action),e.jsx("span",{className:"ml-2 text-sm text-white",children:(t=s.action)==null?void 0:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:s.user_email||"Anonymous"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-white",children:s.ip_address||"Unknown"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white",children:s.resource_type||"N/A"}),s.resource_id&&e.jsxs("span",{className:"text-xs text-gray-400 block mt-1",children:["ID: ",s.resource_id]})]})})]},s.id)})})]})}),d>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium",children:N+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(p,x.length)})," of ",e.jsx("span",{className:"font-medium",children:x.length})," logs"]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>m(1),disabled:n===1,className:"px-3 py-1 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),e.jsx("button",{onClick:()=>m(s=>Math.max(1,s-1)),disabled:n===1,className:"px-3 py-1 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Prev"}),e.jsxs("div",{className:"px-3 py-1 bg-slate-600 rounded",children:[n," of ",d]}),e.jsx("button",{onClick:()=>m(s=>Math.min(d,s+1)),disabled:n>=d,className:"px-3 py-1 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"}),e.jsx("button",{onClick:()=>m(d),disabled:n>=d,className:"px-3 py-1 rounded bg-slate-700 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})]})]})]})};export{J as default};
