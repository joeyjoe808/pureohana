import{c as _,r as f,s as F,j as t,A,X as T,i as G}from"./index-D4gBdtZF.js";import{U as V}from"./upload-CJi8tuAb.js";import{R as W}from"./refresh-cw-kYokf9fA.js";import{C as B}from"./check-DJ6ce73g.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=_("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),q=(R={})=>{const[$,m]=f.useState(!1),[d,w]=f.useState(0),[S,p]=f.useState(null),[k,I]=f.useState(null),{bucket:g="media",folder:y="uploads",fileTypes:j=["image/*","video/*"],maxSizeMB:c=50,onSuccess:v,onError:D,generateThumbnail:b=!1}=R,u=a=>{const r=c*1024*1024;if(a.size>r)return{valid:!1,error:`File size exceeds maximum allowed size of ${c}MB`};if(j.length>0){const s=a.type;if(!j.some(l=>{if(l.endsWith("/*")){const o=l.split("/")[0];return s.startsWith(`${o}/`)}return l===s}))return{valid:!1,error:`File type not supported. Allowed types: ${j.join(", ")}`}}return{valid:!0}},L=a=>{var l;const r=new Date().getTime(),s=Math.floor(Math.random()*1e3),i=((l=a.name.split(".").pop())==null?void 0:l.toLowerCase())||"";return`${r}_${s}.${i}`},M=a=>new Promise(r=>{if(!a.type.startsWith("image/")){r(null);return}const s=new Image;s.onload=()=>{r({width:s.width,height:s.height}),URL.revokeObjectURL(s.src)},s.onerror=()=>{r(null),URL.revokeObjectURL(s.src)},s.src=URL.createObjectURL(a)}),N=async a=>!b||!a.type.startsWith("image/")?null:new Promise(r=>{const s=new Image;s.onload=()=>{const i=document.createElement("canvas"),l=i.getContext("2d");if(!l){r(null);return}const o=300;let e=s.width,n=s.height;e>n?e>o&&(n=Math.round(n*o/e),e=o):n>o&&(e=Math.round(e*o/n),n=o),i.width=e,i.height=n,l.drawImage(s,0,0,e,n),i.toBlob(h=>{if(!h){r(null);return}const U=new File([h],`thumb_${a.name}`,{type:"image/jpeg",lastModified:new Date().getTime()}),P=`${y}/thumbnails/${L(U)}`;F.storage.from(g).upload(P,U).then(({data:C})=>{if(C){const{data:E}=F.storage.from(g).getPublicUrl(P);r(E.publicUrl)}else r(null)}).catch(()=>{r(null)})},"image/jpeg",.75),URL.revokeObjectURL(s.src)},s.onerror=()=>{r(null),URL.revokeObjectURL(s.src)},s.src=URL.createObjectURL(a)}),x=async a=>{try{m(!0),p(null),w(0);const r=u(a);if(!r.valid)throw new Error(r.error);const s=L(a),i=`${y}/${s}`,l=await M(a),{data:o,error:e}=await F.storage.from(g).upload(i,a,{cacheControl:"3600",upsert:!1});if(e)throw e;const{data:n}=F.storage.from(g).getPublicUrl(i),h=n.publicUrl;let U=null;if(b&&(U=await N(a)),y==="media_library"||y==="uploads")try{await F.from("media_library").insert({file_name:a.name,file_path:h,file_type:a.type,file_size:a.size,width:l==null?void 0:l.width,height:l==null?void 0:l.height,thumbnail_path:U})}catch(P){console.warn("Could not add to media library:",P)}return I(h),w(100),v&&v(h,a),h}catch(r){return console.error("File upload error:",r),p(r),D&&D(r),null}finally{m(!1)}};return{uploadFile:x,uploadMultipleFiles:async a=>{const r=[];for(let s=0;s<a.length;s++){const i=await x(a[s]);i&&r.push(i),w((s+1)/a.length*100)}return r},isUploading:$,progress:d,error:S,uploadedUrl:k}},K=({onUploadComplete:R,onUploadError:$,value:m,onChange:d,folder:w="uploads",bucket:S="media",fileTypes:p=["image/*"],maxSizeMB:k=10,className:I="",buttonText:g="Upload File",placeholder:y="No file selected",showPreview:j=!0})=>{const[c,v]=f.useState(m||null),[D,b]=f.useState(!1),u=f.useRef(null),L={folder:w,bucket:S,fileTypes:p,maxSizeMB:k,onSuccess:e=>{v(e),d&&d(e),R&&R(e)},onError:e=>{$&&$(e)}},{uploadFile:M,isUploading:N,error:x}=q(L),O=async e=>{if(e.target.files&&e.target.files[0]){const n=e.target.files[0];await M(n)}},a=async e=>{if(e.preventDefault(),e.stopPropagation(),b(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const n=e.dataTransfer.files[0];await M(n)}},r=e=>{e.preventDefault(),e.stopPropagation(),b(!0)},s=e=>{e.preventDefault(),e.stopPropagation(),b(!1)},i=()=>{v(null),d&&d(""),u.current&&(u.current.value="")},l=e=>/\.(jpeg|jpg|gif|png|webp|svg)$/i.test(e),o=e=>/\.(mp4|webm|ogg|mov)$/i.test(e);return t.jsxs("div",{className:`${I}`,children:[t.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-colors ${D?"border-yellow-400 bg-yellow-400/10":"border-slate-600 hover:border-slate-500"} ${x?"border-red-500 bg-red-500/10":""}`,onDragOver:r,onDragLeave:s,onDrop:a,children:[!N&&!c&&t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3 text-center",children:[t.jsx(V,{className:"h-8 w-8 text-gray-400"}),t.jsxs("div",{className:"text-sm text-gray-300",children:[t.jsx("p",{children:"Drag and drop your file here, or"}),t.jsx("button",{type:"button",className:"mt-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md transition-colors",onClick:()=>{var e;return(e=u.current)==null?void 0:e.click()},children:g})]}),t.jsx("input",{ref:u,type:"file",className:"hidden",onChange:O,accept:p.join(",")}),t.jsx("p",{className:"text-xs text-gray-500",children:y}),p.includes("image/*")&&t.jsx("p",{className:"text-xs text-gray-500",children:"Supported formats: JPEG, PNG, GIF, WebP, SVG"}),p.includes("video/*")&&t.jsx("p",{className:"text-xs text-gray-500",children:"Supported formats: MP4, WebM, OGG, MOV"}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Maximum file size: ",k,"MB"]})]}),N&&t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3 py-4",children:[t.jsx(W,{className:"h-8 w-8 text-yellow-400 animate-spin"}),t.jsx("p",{className:"text-sm text-gray-300",children:"Uploading file..."})]}),x&&t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3 py-4",children:[t.jsx(A,{className:"h-8 w-8 text-red-500"}),t.jsx("p",{className:"text-sm text-red-400",children:x.message}),t.jsx("button",{type:"button",className:"mt-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md transition-colors",onClick:()=>{var e;return(e=u.current)==null?void 0:e.click()},children:"Try Again"})]}),c&&!N&&!x&&j&&t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",onClick:i,className:"absolute top-2 right-2 rounded-full bg-black/70 p-1 text-gray-300 hover:text-white transition-colors",title:"Remove file",children:t.jsx(T,{className:"h-4 w-4"})}),l(c)?t.jsx("div",{className:"flex justify-center",children:t.jsx("img",{src:c,alt:"Preview",className:"max-h-64 rounded-lg"})}):o(c)?t.jsx("div",{className:"flex justify-center",children:t.jsx("video",{src:c,controls:!0,className:"max-h-64 rounded-lg"})}):t.jsxs("div",{className:"flex items-center justify-center space-x-2 p-4",children:[t.jsx(z,{className:"h-8 w-8 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-300",children:"File uploaded successfully"}),t.jsx(B,{className:"h-5 w-5 text-green-500"})]}),t.jsx("div",{className:"mt-2 flex justify-center",children:t.jsx("button",{type:"button",className:"text-xs text-yellow-400 hover:text-yellow-300 transition-colors",onClick:()=>{var e;return(e=u.current)==null?void 0:e.click()},children:"Upload a different file"})})]})]}),m&&!j&&t.jsxs("div",{className:"mt-2 flex items-center justify-between bg-slate-700 rounded p-2",children:[l(m)?t.jsxs("div",{className:"flex items-center",children:[t.jsx(G,{className:"h-4 w-4 text-gray-400 mr-2"}),t.jsx("span",{className:"text-xs text-gray-300 truncate max-w-xs",children:"Image uploaded"})]}):t.jsxs("div",{className:"flex items-center",children:[t.jsx(z,{className:"h-4 w-4 text-gray-400 mr-2"}),t.jsx("span",{className:"text-xs text-gray-300 truncate max-w-xs",children:m.split("/").pop()})]}),t.jsx("button",{type:"button",onClick:i,className:"text-gray-400 hover:text-red-400 transition-colors",title:"Remove file",children:t.jsx(T,{className:"h-4 w-4"})})]}),t.jsx("input",{type:"hidden",value:c||"",onChange:e=>{d&&d(e.target.value)}})]})};export{K as F};
